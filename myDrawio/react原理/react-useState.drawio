<mxfile>
    <diagram id="yiS49sryotYYYr_ddpnm" name="第 1 页">
        <mxGraphModel dx="2738" dy="2120" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="2" target="5">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="2" value="mount阶段&lt;br&gt;(ReactDOM.render)&lt;br&gt;初始化的过程" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="40" y="80" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="5" target="9">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="5" value="&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;span style=&quot;color: #a6e22e&quot;&gt;renderWithHooks&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
                    <mxGeometry x="240" y="80" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="8" value="&lt;h1&gt;renderWithHooks&lt;/h1&gt;&lt;p&gt;1.&amp;nbsp;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt;currentlyRenderingFiber&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt; &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(249 , 38 , 114)&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt; &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(253 , 151 , 31) ; font-style: italic&quot;&gt;workInProgress&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt;;&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;font color=&quot;#f8f8f2&quot; face=&quot;menlo, monaco, courier new, monospace&quot;&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34)&quot;&gt;将当前组件的fiber，赋值给全局变量，之后setState会闭包这个fiber，后续调用时，拿到。&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p&gt;&lt;font color=&quot;#f8f8f2&quot; face=&quot;menlo, monaco, courier new, monospace&quot;&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/p&gt;&lt;p&gt;&lt;font color=&quot;#f8f8f2&quot; face=&quot;menlo, monaco, courier new, monospace&quot;&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34)&quot;&gt;2.&amp;nbsp;&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt;ReactCurrentDispatcher&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt;.current &lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(249 , 38 , 114)&quot;&gt;=&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(253 , 151 , 31) ; font-style: italic&quot;&gt;current&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt; &lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(249 , 38 , 114)&quot;&gt;===&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt; &lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(174 , 129 , 255)&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt; &lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(249 , 38 , 114)&quot;&gt;||&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt; &lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(253 , 151 , 31) ; font-style: italic&quot;&gt;current&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt;.memoizedState &lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(249 , 38 , 114)&quot;&gt;===&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt; &lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(174 , 129 , 255)&quot;&gt;null&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(249 , 38 , 114)&quot;&gt;?&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt; HooksDispatcherOnMount&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(249 , 38 , 114)&quot;&gt;:&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt; HooksDispatcherOnUpdate;&lt;/span&gt;&lt;/p&gt;&lt;span style=&quot;color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; background-color: rgb(39 , 40 , 34)&quot;&gt;hook方法&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt;绑定全局，这样组件内hook就能拿到方法。为啥要做这个三元? memoizedState有值时，则进入onUpdate模式。此时useState和mount模式时有一些区别，后续会说道&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; background-color: rgb(39 , 40 , 34)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;p&gt;&lt;font color=&quot;#f8f8f2&quot; face=&quot;menlo, monaco, courier new, monospace&quot;&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34)&quot;&gt;3.&amp;nbsp;&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(102 , 217 , 239) ; font-style: italic&quot;&gt;let&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt; &lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt;children&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt; &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(249 , 38 , 114)&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt; &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(166 , 226 , 46)&quot;&gt;Component&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(253 , 151 , 31) ; font-style: italic&quot;&gt;props&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(253 , 151 , 31) ; font-style: italic&quot;&gt;secondArg&lt;/span&gt;&lt;span style=&quot;background-color: rgb(39 , 40 , 34) ; color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt;);&lt;/span&gt;&lt;/p&gt;&lt;p&gt;调用组件生成vdom，后续其它函数通过vdom转化为fiber，并挂载到当前fiber.children&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
                    <mxGeometry x="-180" y="-360" width="1030" height="250" as="geometry"/>
                </mxCell>
                <mxCell id="12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="9" target="11">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="9" value="调用组件方法&lt;br&gt;&lt;span style=&quot;color: rgb(166 , 226 , 46) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; text-align: left&quot;&gt;Component&lt;/span&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
                    <mxGeometry x="440" y="80" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="11" target="13">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="11" value="&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;span style=&quot;color: #a6e22e&quot;&gt;useState()&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(249 , 38 , 114)&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt; &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt;dispatcher&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(166 , 226 , 46)&quot;&gt;useState&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; color: rgb(166 , 226 , 46)&quot;&gt;initialState&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace&quot;&gt;);&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;span style=&quot;text-align: left&quot;&gt;ReactCurrentDispatcher&lt;/span&gt;&lt;span style=&quot;text-align: left&quot;&gt;.current&lt;/span&gt;&lt;span style=&quot;color: #a6e22e&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
                    <mxGeometry x="640" y="80" width="350" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="13" target="15">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="13" value="&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;div style=&quot;line-height: 18px&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #a6e22e&quot;&gt;mountState&lt;/span&gt;&amp;lt;&lt;span style=&quot;color: rgb(166 , 226 , 46)&quot;&gt;S&lt;/span&gt;&amp;gt;(&lt;/div&gt;&lt;div&gt;  &lt;span style=&quot;color: #a6e22e&quot;&gt;initialState&lt;/span&gt;&lt;span style=&quot;color: #f92672&quot;&gt;:&lt;/span&gt; (() &lt;span style=&quot;color: #66d9ef ; font-style: italic&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span style=&quot;color: rgb(166 , 226 , 46)&quot;&gt;S&lt;/span&gt;) &lt;span style=&quot;color: #f92672&quot;&gt;|&lt;/span&gt; &lt;span style=&quot;color: rgb(166 , 226 , 46)&quot;&gt;S&lt;/span&gt;)&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
                    <mxGeometry x="1185" y="80" width="275" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="15" target="18">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="15" value="&lt;div style=&quot;background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;span style=&quot;color: rgb(102 , 217 , 239) ; font-style: italic&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(248 , 248 , 242)&quot;&gt;&amp;nbsp;hook&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(249 , 38 , 114)&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(248 , 248 , 242)&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(166 , 226 , 46)&quot;&gt;mountWorkInProgressHook&lt;/span&gt;&lt;span style=&quot;color: rgb(248 , 248 , 242)&quot;&gt;();&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;span style=&quot;color: rgb(248 , 248 , 242)&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;初始化一个空hook对象，第一个hook赋值给&lt;/div&gt;&lt;div style=&quot;background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;div style=&quot;color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;currentlyRenderingFiber.memoizedState = workInProgressHook = hook&lt;/div&gt;&lt;div style=&quot;color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;后续的hook对象，赋值给&lt;/div&gt;&lt;div style=&quot;color: rgb(248 , 248 , 242) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;div style=&quot;line-height: 18px&quot;&gt;workInProgressHook &lt;span style=&quot;color: #f92672&quot;&gt;=&lt;/span&gt; workInProgressHook.next &lt;span style=&quot;color: #f92672&quot;&gt;=&lt;/span&gt; hook&lt;/div&gt;&lt;div style=&quot;line-height: 18px&quot;&gt;形成一个hook链表，即常见解析里hook的顺序&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
                    <mxGeometry x="1164.38" y="270" width="316.25" height="120" as="geometry"/>
                </mxCell>
                <mxCell id="17" value="第一步" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
                    <mxGeometry x="1315" y="160" width="50" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="18" target="21">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="18" value="&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;div&gt;// 把初始值赋值给当前hook对象&lt;/div&gt;&lt;div&gt;  hook.memoizedState &lt;span style=&quot;color: #f92672&quot;&gt;=&lt;/span&gt; hook.baseState &lt;span style=&quot;color: #f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #a6e22e&quot;&gt;initialState&lt;/span&gt;;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;// 把更新时的方法绑定在hook.dispatch上，并返回，这样我们就可以setState开始后续操作了&lt;/div&gt;&lt;div&gt;// 注意正是因为这里dispatchAction绑定住了currentFiber，这样我们才能在setState时修改&lt;/div&gt;&lt;div&gt;当前的fiber。否则函数组件又没有this，如何修改节点信息，就成为了迷惑点。&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;div&gt;  const dispatch: &lt;span style=&quot;color: rgb(166 , 226 , 46)&quot;&gt;Dispatch&lt;/span&gt;&lt;span style=&quot;color: #f92672&quot;&gt;&amp;lt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: rgb(166 , 226 , 46)&quot;&gt;BasicStateAction&lt;/span&gt;&lt;span style=&quot;color: #f92672&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;color: rgb(166 , 226 , 46)&quot;&gt;S&lt;/span&gt;&lt;span style=&quot;color: #f92672&quot;&gt;&amp;gt;&lt;/span&gt;,&lt;/div&gt;&lt;div&gt;  &amp;gt; = (queue.dispatch &lt;span style=&quot;color: #f92672&quot;&gt;=&lt;/span&gt; (&lt;span style=&quot;color: #a6e22e&quot;&gt;dispatchAction&lt;/span&gt;.&lt;span style=&quot;color: #66d9ef&quot;&gt;bind&lt;/span&gt;(&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: #ae81ff&quot;&gt;null&lt;/span&gt;,&lt;/div&gt;&lt;div&gt;    currentlyRenderingFiber,&lt;/div&gt;&lt;div&gt;    queue,&lt;/div&gt;&lt;div&gt;  ): any));&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
                    <mxGeometry x="1031.25" y="550" width="582.5" height="200" as="geometry"/>
                </mxCell>
                <mxCell id="20" value="第二步" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
                    <mxGeometry x="1315" y="460" width="50" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="21" value="&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;// 返回值，和修改值的方法&lt;/div&gt;&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;return [hook.memoizedState, dispatch];&lt;/div&gt;" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
                    <mxGeometry x="1173.75" y="940" width="297.5" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="23" value="第三步" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
                    <mxGeometry x="1315" y="830" width="50" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="26" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="24" target="25">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="24" value="主动触发阶段:" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="40" y="1190" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="28" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="25" target="27">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="25" value="调用setState" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="240" y="1190" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="32" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="27" target="31">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="27" value="&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;span style=&quot;color: #a6e22e&quot;&gt;dispatchAction&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="440" y="1190" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="30" value="&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;div&gt;  &lt;span style=&quot;color: #fd971f ; font-style: italic&quot;&gt;fiber&lt;/span&gt;&lt;span style=&quot;color: #f92672&quot;&gt;: &lt;/span&gt;,当前fiber&lt;/div&gt;&lt;div&gt;  &lt;span style=&quot;color: #fd971f ; font-style: italic&quot;&gt;queue&lt;/span&gt;&lt;span style=&quot;color: #f92672&quot;&gt;:&lt;/span&gt;&amp;nbsp;保存&lt;/div&gt;&lt;div&gt;  &lt;span style=&quot;color: #fd971f ; font-style: italic&quot;&gt;action&lt;/span&gt;&lt;span style=&quot;color: #f92672&quot;&gt;:&lt;/span&gt; 触发修改的值&lt;/div&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
                    <mxGeometry x="425" y="1109" width="150" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="35" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="31" target="34">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="31" value="&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;div&gt;  &lt;span style=&quot;color: #88846f&quot;&gt;// 创建一个update对象，保存此次更新的信息，比如传入的action&lt;/span&gt;&lt;/div&gt;&lt;div&gt;  &lt;span style=&quot;color: #66d9ef ; font-style: italic&quot;&gt;const&lt;/span&gt; update&lt;span style=&quot;color: #f92672&quot;&gt;:&lt;/span&gt; &lt;span style=&quot;color: rgb(166 , 226 , 46)&quot;&gt;Update&lt;/span&gt;&amp;lt;&lt;span style=&quot;color: rgb(166 , 226 , 46)&quot;&gt;S&lt;/span&gt;, &lt;span style=&quot;color: rgb(166 , 226 , 46)&quot;&gt;A&lt;/span&gt;&amp;gt; &lt;span style=&quot;color: #f92672&quot;&gt;=&lt;/span&gt; {&lt;/div&gt;&lt;div&gt;    lane,&lt;/div&gt;&lt;div&gt;    action,&lt;/div&gt;&lt;div&gt;    eagerReducer: &lt;span style=&quot;color: #ae81ff&quot;&gt;null&lt;/span&gt;,&lt;/div&gt;&lt;div&gt;    eagerState: &lt;span style=&quot;color: #ae81ff&quot;&gt;null&lt;/span&gt;,&lt;/div&gt;&lt;div&gt;    next: (&lt;span style=&quot;color: #fd971f ; font-style: italic&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;color: #f92672&quot;&gt;:&lt;/span&gt; any),&lt;/div&gt;&lt;div&gt;  };&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="297.5" y="1410" width="405" height="160" as="geometry"/>
                </mxCell>
                <mxCell id="33" value="第一步" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
                    <mxGeometry x="510" y="1320" width="50" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="38" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="34" target="37">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="34" value="&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;div&gt;  &lt;span style=&quot;color: #88846f&quot;&gt;// 让组件内每一个setState产生的update形成链表，并最后保存在queue上，即fiber.memoizedState.queue。&lt;/span&gt;&lt;/div&gt;&lt;div&gt;  &lt;span style=&quot;color: #88846f&quot;&gt;// Append the update to the end of the list.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;  const pending &lt;span style=&quot;color: #f92672&quot;&gt;=&lt;/span&gt; &lt;span style=&quot;color: #fd971f ; font-style: italic&quot;&gt;queue&lt;/span&gt;.pending;&lt;/div&gt;&lt;div&gt;  &lt;span style=&quot;color: #a6e22e&quot;&gt;if&lt;/span&gt; (pending &lt;span style=&quot;color: #f92672&quot;&gt;===&lt;/span&gt; &lt;span style=&quot;color: #ae81ff&quot;&gt;null&lt;/span&gt;) {&lt;/div&gt;&lt;div&gt;    &lt;span style=&quot;color: #88846f&quot;&gt;// This is the first update. Create a circular list.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;    update.next &lt;span style=&quot;color: #f92672&quot;&gt;=&lt;/span&gt; update;&lt;/div&gt;&lt;div&gt;  } else {&lt;/div&gt;&lt;div&gt;    update.next &lt;span style=&quot;color: #f92672&quot;&gt;=&lt;/span&gt; pending.next;&lt;/div&gt;&lt;div&gt;    pending.next &lt;span style=&quot;color: #f92672&quot;&gt;=&lt;/span&gt; update;&lt;/div&gt;&lt;div&gt;  }&lt;/div&gt;&lt;div&gt;  &lt;span style=&quot;color: #fd971f ; font-style: italic&quot;&gt;queue&lt;/span&gt;.pending &lt;span style=&quot;color: #f92672&quot;&gt;=&lt;/span&gt; update;&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="210" y="1730" width="580" height="240" as="geometry"/>
                </mxCell>
                <mxCell id="36" value="第二步" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
                    <mxGeometry x="505" y="1650" width="50" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="37" value="&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;span style=&quot;color: #a6e22e&quot;&gt;// 开启更新调度&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;span style=&quot;color: #a6e22e&quot;&gt;scheduleUpdateOnFiber&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="385" y="2150" width="230" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="39" value="第三步" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;" vertex="1" parent="1">
                    <mxGeometry x="505" y="2040" width="50" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="45" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="41" target="44">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="41" value="当再次调度更新此组件时&lt;br&gt;(mount第一次，setState为第二次)" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="40" y="2380" width="190" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="48" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=14;" edge="1" parent="1" source="44" target="47">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="44" value="&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;span style=&quot;color: #a6e22e&quot;&gt;renderWithHooks&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;span style=&quot;color: #88846f&quot;&gt;// 初次mount时，current.memoizedState赋值了，此时三元表达式，全局hook变为update模式&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;div style=&quot;font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;ReactCurrentDispatcher.current &lt;span style=&quot;color: #f92672&quot;&gt;=&amp;nbsp;&lt;/span&gt;&lt;span&gt;HooksDispatcherOnUpdate&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="520" y="2355" width="370" height="110" as="geometry"/>
                </mxCell>
                <mxCell id="46" value="此时调度，再次调用renderWithHooks" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;" vertex="1" parent="1">
                    <mxGeometry x="240" y="2360" width="250" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="50" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=14;" edge="1" parent="1" source="47" target="49">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="47" value="&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;span style=&quot;color: #a6e22e&quot;&gt;updateState&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1095" y="2380" width="225" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="52" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=14;" edge="1" parent="1" source="49" target="51">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="49" value="&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;span style=&quot;color: #a6e22e&quot;&gt;updateReducer&lt;/span&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1110" y="2580" width="192.5" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="54" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=14;" edge="1" parent="1" source="51" target="53">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="51" value="&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;span style=&quot;color: #a6e22e&quot;&gt;updateWorkInProgressHook&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;拿到当前运行的hook，我们之前在mount时，曾赋值给&lt;/div&gt;&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;currentlyRenderingFiber.memoizedState,&lt;/div&gt;&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;这个hook里存储着setState时，的queue链表&lt;/div&gt;" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="998.13" y="2830" width="416.25" height="90" as="geometry"/>
                </mxCell>
                <mxCell id="58" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=14;" edge="1" parent="1" source="53" target="57">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="53" value="&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;span style=&quot;color: #f92672&quot;&gt;do&lt;/span&gt; {&lt;/div&gt;&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;// 循环update,修改hook状态&lt;/div&gt;&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;div style=&quot;line-height: 18px&quot;&gt;} while (update !== null &amp;amp;&amp;amp; update !== first);&lt;/div&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1074.38" y="3070" width="263.74" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="55" value="第一步" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;" vertex="1" parent="1">
                    <mxGeometry x="1250" y="2720" width="60" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="56" value="第二步" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;" vertex="1" parent="1">
                    <mxGeometry x="1240" y="2990" width="60" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="57" value="&lt;div style=&quot;color: rgb(248 , 248 , 242) ; background-color: rgb(39 , 40 , 34) ; font-family: &amp;#34;menlo&amp;#34; , &amp;#34;monaco&amp;#34; , &amp;#34;courier new&amp;#34; , monospace ; line-height: 18px&quot;&gt;&lt;span style=&quot;color: #f92672&quot;&gt;return&lt;/span&gt; [hook.memoizedState, dispatch];&lt;/div&gt;" style="whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1053.13" y="3250" width="306.25" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="59" value="第三步" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;fontSize=14;" vertex="1" parent="1">
                    <mxGeometry x="1240" y="3190" width="60" height="20" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>